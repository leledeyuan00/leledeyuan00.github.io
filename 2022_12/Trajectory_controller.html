<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Logs in 2023-01" href="../2023_01/index.html" /><link rel="prev" title="ATI Sensor development" href="ATI_sensor.html" />

    <!-- Generated with Sphinx 6.1.3 and Furo 2022.12.07 -->
        <title>Denso Robot Trajectory Controller Development - Dayuan Logs documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=91d0f0d1c444bdcb17a68e833c7a53903343c195" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Dayuan Logs  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">Dayuan Logs  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Logs in 2022-12</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="ATI_sensor.html">ATI Sensor development</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Denso Robot Trajectory Controller Development</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../2023_01/index.html">Logs in 2023-01</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../2023_01/Vision.html">Robot Vision for Garment Manipulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2023_01/RealRobotCompliant.html">Real Robot Compliant Experiment</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../notes/index.html">Some notes</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../notes/robot_description.html">How to get the robot_description parameter well?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notes/real_time_pub_sub.html">ROS2 realtime pub and sub</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notes/rotation_error.html">Rotation Error Computing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notes/kinematics_interface.html">Kinematics</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="denso-robot-trajectory-controller-development">
<h1>Denso Robot Trajectory Controller Development<a class="headerlink" href="#denso-robot-trajectory-controller-development" title="Permalink to this heading">#</a></h1>
<section id="virtual-forward-dynamics">
<h2>Virtual Forward Dynamics<a class="headerlink" href="#virtual-forward-dynamics" title="Permalink to this heading">#</a></h2>
<p>First of all, I decide to use a virtual forward dynamics for solve inverse kinematics probelm.</p>
<p>By the <a class="reference external" href="https://github.com/fzi-forschungszentrum-informatik/cartesian_controllers">stefanscherzinger</a></p>
<section id="first-problem">
<h3>First Problem<a class="headerlink" href="#first-problem" title="Permalink to this heading">#</a></h3>
<p>The first problem when I used this package is that it cannot find the parameter well.
Such as: <em>robot_description</em>, and other controller needed parameters.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For robot_description, a <strong>Parameter Client</strong> can be used to solve this problem. <a class="reference internal" href="../notes/robot_description.html#robot-rescription-parameter"><span class="std std-ref">Robot Rescription Parameter</span></a></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is for uncontroller package. If the ROS controller is used here, the parameter can be loaded directly in the controller spawn node which usually combined with the urdf file loaded.</p>
</div>
</section>
<section id="second-problem">
<h3>Second Problem<a class="headerlink" href="#second-problem" title="Permalink to this heading">#</a></h3>
<p>The other parameter also cannot be found.</p>
<p>Does the parameter not be loaded correctly in this controller?</p>
</section>
<section id="id1">
<h3>12-16<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h3>
<p>I can use the cartesian motion controller in this package.</p>
</section>
</section>
<section id="admittance-controller-in-ros2-controllers">
<h2>Admittance Controller in ROS2 controllers<a class="headerlink" href="#admittance-controller-in-ros2-controllers" title="Permalink to this heading">#</a></h2>
<p>There is an official admittance controller in ROS2 controllers.
Maybe I can use this controller first to fammiliar with the ros2 controller.
Then write a customized controller by myself.</p>
<p>There are some function in this controller that seems interesting.</p>
<section id="realtime-command">
<h3>Realtime command<a class="headerlink" href="#realtime-command" title="Permalink to this heading">#</a></h3>
<p>It declares a subscriber to update the realtime command variable. And use this variable in the update function.
It will ganranttee the performace of the command generated in a certain loop rate and not depend on the user send frequency.</p>
<p><a class="reference internal" href="../notes/real_time_pub_sub.html#realtime-pub-sub"><span class="std std-ref">Realtime pub and sub in ROS2 by C++</span></a></p>
</section>
</section>
<section id="custom-controller">
<h2>Custom Controller<a class="headerlink" href="#custom-controller" title="Permalink to this heading">#</a></h2>
<p>Do I need to write a customized controller?</p>
<p>The current controller in ROS2 controllers cannot work well.
In Stefan’s package, the impedance parameter is setted by ROS2 parameter system. It is not a good way to set the parameter.</p>
<ol class="arabic simple">
<li><p>Maybe service is a better way to set the parameter.</p></li>
<li><p>And maybe I also will try to combine the Moveit2 Servoing with this controller.</p></li>
<li><p>And I think it is a good chance to learn how to write a controller in ROS2.</p></li>
<li><p>I also need to add some velocity limitaion in the controller. Both the cartesian velocity and joint velocity.</p></li>
<li><p>Another problem, there is no joint control in the motion controller. It is not flexible.</p></li>
</ol>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>No collision detection, if I wrote a controller by myself. This is an important problem.</p>
</div>
<p>So I should ensure what should be done in the controller.</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>The basic cartesian controller should be developed.</p></li>
<li><p>Add the impedance control in the controller. And it also canbe selected by setting the parameter.</p></li>
<li><p>The parameter of the impedance control should be setted by service in anytime.</p></li>
<li><p>The velocity limitaion should be added in the controller, and it also can be setted by parameter.</p></li>
<li><p>Try to combine the Moveit2 servoing.</p></li>
<li><p>Design joint control interface.</p></li>
</ol>
</div></blockquote>
<p>Maybe I can combine the Moveit2 servoing with a customized kinematics solver and its collision detection. Finnally use the trajectory_controller.</p>
<p>Because in the real environment, it is important to ensure robot safe in large workspace, such as go home or go to some work states.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Professor asked a question today(2022.12.19): why impedance controller does not need too high frequency?</p>
<dl class="simple">
<dt>How to answer this question?</dt><dd><ol class="arabic simple">
<li><p>The impedance controller is a kind of feedback controller in the position control interface. It will not change the system state, just make the motion near the current state. So it does not need too high frequency.</p></li>
<li><p>The velocity control and force control is the iner loop of the impedance controller. It is executed into the robotic controller itself. It is already a high frequency control and it don’t need be considered by us.</p></li>
</ol>
</dd>
</dl>
</div>
</section>
<section id="custom-ik-solver">
<h2>Custom IK Solver<a class="headerlink" href="#custom-ik-solver" title="Permalink to this heading">#</a></h2>
<p>The moveit2 servoing is based on the IK solver from moveit2. So I can write a custome IK solver to combine it.</p>
<p>Progress:</p>
<ol class="arabic">
<li><p>Find how to get the H matrix in Stefan’s package.</p></li>
<li><p>Config the moveit2. And try to use the moveit2 in the Gazebo.</p>
<p>It is referenced by <a class="reference external" href="https://github.com/UniversalRobots/Universal_Robots_ROS2_Driver/tree/main/ur_moveit_config">UR moveit config</a></p>
</li>
<li><p>Config the moveit2 servoing.</p>
<p>Servoing works! The main problem is that the header.stamp should be setted as the current ros time; So publisher cli dosen’t work here.</p>
</li>
<li><p>Develop the custom IK solver.</p>
<p>Try to develop the custom IK solver, try to reference the official IK solver in moveit2.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<blockquote>
<div><p>In servoing, the kinematics config xml should as a parameter in the servoing node. Then the kinematics solver can be loaded in the servoing node.</p>
</div></blockquote>
<ul class="simple">
<li><p>Add the Stefan’s inverse kinematics</p></li>
<li><p>Add the Impedance Controller in this IK solver</p></li>
</ul>
</div>
</li>
</ol>
<section id="the-problem-of-the-ik-solver">
<h3>The problem of the IK solver<a class="headerlink" href="#the-problem-of-the-ik-solver" title="Permalink to this heading">#</a></h3>
<p>It is a solver, not run in the realtime loop. So it is not suitable for the compliant control if used directly.
I can design a custom servoing node to use this IK solver. And the servoing node can be used in the realtime loop.</p>
<p>There is a pose tracking funciton in the servo. Maybe I can try to use it.</p>
</section>
<section id="custom-pose-tracking-package">
<h3>Custom Pose Tracking package<a class="headerlink" href="#custom-pose-tracking-package" title="Permalink to this heading">#</a></h3>
<p>Finally, I used a customized pose tracking package referenced with the official pose tracking package in moveit2. Wrote the impedance controller in the pose trakcing.
In the pose tracking, PID controller is used to reach target.</p>
<p>And the tracking package is used servoing class to generate the command. So that it can realize the collision avoidance.</p>
<p>In the real experiment, the trajectory_controller has some problem, I don’t know why, it likes I write the custom trajectory message before to control the simulated UR.
I thought it is my fault before, it seems that the problem has another reason. Currently, I use a script to switch the follow joint controller and trajectory controller to use moveit plan and servoing.</p>
</section>
</section>
<section id="todo">
<h2>TODO:<a class="headerlink" href="#todo" title="Permalink to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>Try to use the admittance controller in ROS2 controllers.</p></li>
<li><p>Try to use the virtual forward dynamics controller.</p></li>
<li><p>Try to customize a controller by myself.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>英语写的还是太麻烦了，以后还是中文写好了…</p>
<p>【不过还是要多写写英语，不然会忘的太快了。】 &lt;- 卧槽 这一句是AI给我写出来的。。我谢谢它了。。。
好吧 既然AI给我写了 那我还是继续练练英语好了 虽然一堆语法错误 哈哈</p>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../2023_01/index.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Logs in 2023-01</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="ATI_sensor.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">ATI Sensor development</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022, Dayuan Chen
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Denso Robot Trajectory Controller Development</a><ul>
<li><a class="reference internal" href="#virtual-forward-dynamics">Virtual Forward Dynamics</a><ul>
<li><a class="reference internal" href="#first-problem">First Problem</a></li>
<li><a class="reference internal" href="#second-problem">Second Problem</a></li>
<li><a class="reference internal" href="#id1">12-16</a></li>
</ul>
</li>
<li><a class="reference internal" href="#admittance-controller-in-ros2-controllers">Admittance Controller in ROS2 controllers</a><ul>
<li><a class="reference internal" href="#realtime-command">Realtime command</a></li>
</ul>
</li>
<li><a class="reference internal" href="#custom-controller">Custom Controller</a></li>
<li><a class="reference internal" href="#custom-ik-solver">Custom IK Solver</a><ul>
<li><a class="reference internal" href="#the-problem-of-the-ik-solver">The problem of the IK solver</a></li>
<li><a class="reference internal" href="#custom-pose-tracking-package">Custom Pose Tracking package</a></li>
</ul>
</li>
<li><a class="reference internal" href="#todo">TODO:</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    </body>
</html>